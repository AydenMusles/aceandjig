var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},t3PageLoadHelpers;!function(o){o.loadImages=function(e,t){var i=this,n=$("img",e).length,s=1,o=!1;n.length?$("img",e).load(function(){++s>=n&&i.isRequestOn&&!o&&(t(e),o=!0)}).each(function(){this.complete&&$(this).load()}):t(e)},o.savePageState=function(e){if(void 0===e&&(e={key:"",value:""}),history.pushState){var t="",i=e.key,n=e.value;if(o.isQueryStringKeyInUrl(i))t=o.updateQueryStringParameter(window.location.href,i,encodeURIComponent(n));else{var s=i+"="+encodeURIComponent(n);s=""!=window.location.search?window.location.search+"&"+s:"?"+s,t=window.location.protocol+"//"+window.location.host+window.location.pathname+s}t+=window.location.hash,window.history.pushState({path:t},"",t)}else console.log("History pushstate not supported")},o.getQueryStringByKey=function(e,t){void 0===t&&(t=""),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t?i.exec(t):i.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))},o.isQueryStringKeyInUrl=function(e){return-1!=location.search.indexOf(e)},o.updateQueryStringParameter=function(e,t,i){var n=new RegExp("([?&])"+t+"=.*?(&|$)","i"),s=-1!==e.indexOf("?")?"&":"?";return e.match(n)?e.replace(n,"$1"+t+"="+i+"$2"):e+s+t+"="+i},o.removeQueryStringParameter=function(e,t){var i=e.split("?");if(2<=i.length){for(var n=encodeURIComponent(t)+"=",s=i[1].split(/[&;]/g),o=s.length;0<o--;)-1!==s[o].lastIndexOf(n,0)&&s.splice(o,1);return e=i[0]+"?"+s.join("&")}return e}}(t3PageLoadHelpers||(t3PageLoadHelpers={})),function(r){var e=function(){function i(e,t){this.isRequestOn=!1,this.currentLink=null,this.bothNextAndPreviousAvailableOnLoad=!1,this.links={next:"next",previous:"previous"},this.hasAllPagesLoaded=!1,this.element=e,this.settings=r.extend(i.defaultSettings,t),this.itemsWrapper=r(this.settings.selectors.itemsWrapper),this.paginationWrapper=r(this.settings.selectors.paginationWrapper),this.bothNextAndPreviousAvailableOnLoad=r(this.settings.selectors.nextPageLink,this.paginationWrapper).length&&r(this.settings.selectors.previousPageLink,this.paginationWrapper).length}return i.prototype.getPage=function(e,t){var i=this;this.isRequestOn||r.ajax({url:e,type:"get",beforeSend:function(){i.isRequestOn=!0,"function"==typeof i.settings.callBacks.beforePageLoad&&i.settings.callBacks.beforePageLoad()},success:function(e){t(e)}})},i.defaultSettings={selectors:{itemsWrapper:".collection-matrix",item:"li",nextPageLink:"#NextPaginationLink a",previousPageLink:"#PreviousPaginationLink a",paginationWrapper:".pagination",scrollableElem:null},manualLoading:!1,pageQueryStringKey:"page",waitForImagesToBeLoaded:!1,enablePageState:!1,throttleDelay:100,callBacks:{onAllPagesLoaded:function(){},onPageLoad:function(e){},beforePageLoad:function(){}}},i}(),i=function(i){function e(e,t){i.call(this,e,t)}return __extends(e,i),e.prototype.init=function(){this._bindEvents()},e.prototype._bindEvents=function(){var t=this;this.paginationWrapper.on("click",this.settings.selectors.nextPageLink,function(e){e.preventDefault(),t.linkedClicked=t.links.next,t.currentLink=r(this).attr("href"),t.getPage(t.currentLink,function(e){t._pageLoadedSuccess(e)})}),this.paginationWrapper.on("click",this.settings.selectors.previousPageLink,function(e){e.preventDefault(),t.linkedClicked=t.links.previous,t.currentLink=r(this).attr("href"),t.getPage(t.currentLink,function(e){t._pageLoadedSuccess(e)})})},e.prototype._updateNextAndPreviousLinks=function(e){var t=e.find(this.settings.selectors.nextPageLink),i=e.find(this.settings.selectors.previousPageLink),n=r(this.settings.selectors.nextPageLink,this.paginationWrapper),s=r(this.settings.selectors.previousPageLink,this.paginationWrapper),o=!0,a=!0;this.bothNextAndPreviousAvailableOnLoad&&(this.linkedClicked==this.links.previous&&(o=!1),this.linkedClicked==this.links.next&&(a=!1)),o=n.length&&o,a=s.length&&a,o&&(t.length?n.replaceWith(t):n.remove()),a&&(i.length?s.replaceWith(i):s.remove()),this.hasAllPagesLoaded=!r(this.settings.selectors.nextPageLink,this.paginationWrapper).length&&!r(this.settings.selectors.previousPageLink,this.paginationWrapper).length},e.prototype._pageLoadedSuccess=function(e){var t=this,i=r(e),n=i.find(this.settings.selectors.item);this._updateNextAndPreviousLinks(i),this.settings.waitForImagesToBeLoaded?t3PageLoadHelpers.loadImages(n,function(e){t._processingComplete(e)}):this._processingComplete(n)},e.prototype._processingComplete=function(e){if(this.itemsWrapper.append(r("<div/>").append(e).html()),this.settings.enablePageState){var t=this.currentLink,i=t3PageLoadHelpers.getQueryStringByKey(this.settings.pageQueryStringKey,t);t3PageLoadHelpers.savePageState({key:this.settings.pageQueryStringKey,value:i})}"function"==typeof this.settings.callBacks.onPageLoad&&this.settings.callBacks.onPageLoad(e),this.hasAllPagesLoaded&&"function"==typeof this.settings.callBacks.onAllPagesLoaded&&this.settings.callBacks.onAllPagesLoaded(),this.isRequestOn=!1},e}(e),n=function(i){function a(e,t){i.call(this,e,t),this.scrollTimer=0,this.resizeTimer=0,this.linkedLoaded=null,this.nextPageLink=null,this.previousPageLink=null,this.scrollableElement=r(this.settings.selectors.scrollableElem?this.settings.selectors.scrollableElem:window)}return __extends(a,i),a.prototype.init=function(){var t=this;this._loadLinks(),this.scrollableElement.on("scroll",function(e){a.throttle(function(e){t.isRequestOn||t._scrollEventHandler()},t.settings.throttleDelay)()})},a.prototype._loadLinks=function(){this.nextPageLink=r(this.settings.selectors.nextPageLink,this.paginationWrapper),this.previousPageLink=r(this.settings.selectors.previousPageLink,this.paginationWrapper)},a.prototype._scrollEventHandler=function(){var e=this;requestAnimationFrame(function(){e._trickyInfiniteScroll()})},a.prototype._trickyInfiniteScroll=function(){var t=this,e=r(this.scrollableElement).scrollTop()+r(this.scrollableElement).height(),i=r(this.settings.selectors.item+":visible:last",this.element);if((i.length?i.offset().top:r(this.settings.selectors.item+":last",this.element).offset().top)+r(this.settings.selectors.item+":visible:last",this.element).height()<=e&&this.nextPageLink){var n=this.nextPageLink.attr("href");this.getPage(n,function(e){t._pageLoadedSuccess(e)})}else this.isRequestOn=!1,this.nextPageLink||(r(this.settings.selectors.nextPageLink,this.paginationWrapper).remove(),this.hasAllPagesLoaded||(this.hasAllPagesLoaded=!0,"function"==typeof this.settings.callBacks.onAllPagesLoaded&&this.settings.callBacks.onAllPagesLoaded()))},a.prototype._updateNextAndPreviousLinks=function(e){var t=e.find(this.settings.selectors.nextPageLink);e.find(this.settings.selectors.previousPageLink),t.length?this.nextPageLink=t:this.nextPageLink=null},a.prototype._pageLoadedSuccess=function(e){var t=this,i=r(e),n=i.find(this.settings.selectors.item);this._updateNextAndPreviousLinks(i),this.settings.waitForImagesToBeLoaded?t3PageLoadHelpers.loadImages(n,function(e){t._processingComplete(e)}):this._processingComplete(n)},a.prototype._processingComplete=function(e){this.itemsWrapper.append(r("<div/>").append(e).html()),"function"==typeof this.settings.callBacks.onPageLoad&&this.settings.callBacks.onPageLoad(e),this.isRequestOn=!1},a.prototype._unbindScrollingEvent=function(){},a.throttle=function(e,t){void 0===t&&(t=10);var i,n,s=!1,o=function(){s=!1,e.apply(i,n)};return function(){i=this,n=arguments,s||(s=!0,setTimeout(o,t||a.SCROLL_THROTTLE_DEFAULT_DELAY))}},a.scrollEventHandlerFuncName="_scrollEventHandler",a.SCROLL_THROTTLE_DEFAULT_DELAY=500,a}(e);r.fn.t3PageLoad=function(e){var t=null;return(t=e.manualLoading?new i(r(this),e):new n(r(this),e)).init(),t}}(jQuery);